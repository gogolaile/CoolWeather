package Utils;
import java.util.*;

import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import com.example.train_qurey.R;

public class LoadUtil {


	
	public static SQLiteDatabase createOrOpenDatabase(){
		SQLiteDatabase sld = null;
		try{
			sld = SQLiteDatabase.openDatabase("/data/data/com.example.train_qurey/mydb", null, SQLiteDatabase.OPEN_READWRITE|SQLiteDatabase.CREATE_IF_NECESSARY);
		}catch(Exception e){
			e.printStackTrace();
		}
		return sld;
	}
	
	public static void createTable(String sql){
		SQLiteDatabase sld = createOrOpenDatabase();
		try{
			sld.execSQL(sql);
			sld.close();
		}catch(Exception e){
			e.printStackTrace();
		}
	}
	public static boolean insert(String sql){
		SQLiteDatabase sld = createOrOpenDatabase();
		try{
			sld.execSQL(sql);
			sld.close();
			return true;
		}catch(Exception e){
			return false;
		}
	}
	public static Vector<Vector<String>> query(String sql){
		Vector<Vector<String>> vector = new Vector<Vector<String>>();
		SQLiteDatabase sld = createOrOpenDatabase();
		try{Cursor cursor = sld.rawQuery(sql, new String[]{});
		  while(cursor.moveToNext()){
			  Vector<String> v = new Vector<String>();
			  int col = cursor.getColumnCount();
			  for(int i=0;i < col; i++){
				  v.add(cursor.getString(i));
			  }
			  vector.add(v);
		  }
		  cursor.close();
		  sld.close();			
		}catch(Exception e){
			e.printStackTrace();
		}
		return vector;
	}
	
	public static int getInsertId(String table,String sid){
		int id = 0;
		String sql = "select Max(" + sid + ") from " + table ;
		SQLiteDatabase db = createOrOpenDatabase();
		try{
			Cursor cursor = db.rawQuery(sql, new String[]{});
			if(cursor.moveToNext()){
				id = cursor.getInt(0);
			}
				cursor.close();
				db.close();
		}catch(Exception e){
			e.printStackTrace();
		}
		id++;
		return id;
	} 
	
	public Vector<Vector<String>> getInfo(String info){
		String sql = "select Sname,Rarrivetime,Rstarttime from station,"+"(select Sid,Rid,Rarrivetime,Rstarttime from relation where Tid = " + "(select Tid from train where Tname = '" +info +"')) a"
+"where  a.Sid =staion.Sid order by Rid";		
	Vector<Vector<String>> V_temp = query(sql);
	return V_temp;
}

	public static Vector<Vector<String>> trainsearch(String train_number) {
		// TODO Auto-generated method stub
		String sql = "select Tstartstation,Tterminus,Ttype from train where Tname ='"+ train_number + "'";
		Vector<Vector<String>> temp1 = query(sql);
		sql = "select Tstartstation,Rstarttime from  train,relation where Tname ='"+train_number +"' and relation.Tid = train.Tid and relaton.Sid = (select Sid from station where Sname = train.Tstartstation";
		Vector<Vector<String>> temp2 = query(sql);
		sql = "select Tterminus,Rarrivetime from train,relation where Tname ='" + train_number +"' and relation.Tid = train.Tid and relation.Sid = (select Sid from station where Sname = train.Tterminus)";
		Vector<Vector<String>> temp3 = query(sql);
		temp1 = combine(temp1,temp2,temp3);
		return temp1;
	}
}
